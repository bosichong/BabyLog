import{u as v,a as k,k as x,b as a,o as S,d as I,c as e,w as t,e as l,f as d,g as p,M as F}from"./index.dfad7078.js";import{U as L,L as U}from"./UserOutlined.9a0a0e60.js";const B={class:"minilogin"},O={__name:"Login",setup(A){const c=v(),s=k({username:"",password:"",remember:!0}),_=r=>(sessionStorage.clear(),p.post("v1/token",{username:r.username,password:r.password},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){let i=o.data.access_token;sessionStorage.setItem("token",i),p.defaults.headers={accept:"application / json",Authorization:"Bearer "+sessionStorage.getItem("token")},sessionStorage.getItem("username")===null&&p.get("v1/user/me",{headers:{accept:"application / json",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(function(n){sessionStorage.setItem("user_id",n.data.id),sessionStorage.setItem("username",n.data.username),sessionStorage.setItem("familymember",n.data.familymember),sessionStorage.setItem("sex",n.data.sex),c.push("/blog/main")})}).catch(function(o){F.error().update({title:"\u9519\u8BEF!",content:o.response.data.detail})}),!1),f=r=>{console.log("Failed:",r)},g=x(()=>!(s.username&&s.password));return(r,o)=>{const i=a("a-typography-title"),n=a("a-input"),m=a("a-form-item"),w=a("a-input-password"),h=a("a-button"),b=a("router-link"),y=a("a-form");return S(),I("div",B,[e(i,{level:3},{default:t(()=>[l("Mini Admin")]),_:1}),e(y,{model:s,name:"normal_login",class:"login-form",onFinish:_,onFinishFailed:f},{default:t(()=>[e(m,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:t(()=>[e(n,{value:s.username,"onUpdate:value":o[0]||(o[0]=u=>s.username=u)},{prefix:t(()=>[e(d(L),{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),e(m,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:t(()=>[e(w,{value:s.password,"onUpdate:value":o[1]||(o[1]=u=>s.password=u)},{prefix:t(()=>[e(d(U),{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),e(m,null,{default:t(()=>[e(h,{disabled:d(g),type:"primary","html-type":"submit",class:"login-form-button"},{default:t(()=>[l(" Log in ")]),_:1},8,["disabled"]),l(" Or "),e(b,{to:"/register"},{default:t(()=>[l("register now!")]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{O as default};
