import{a as C,r as k,k as q,b as s,o as x,d as w,c as t,w as l,F as z,g as p,e as u,f as F,j as Z,m as ee,M as d,E as te}from"./index.6ce95f9f.js";import{E as le,D as oe}from"./EditFilled.8cd73e48.js";const ae={key:0},de={__name:"Role",setup(ne){const O=C([]),b=C([]),I=k(0),g=k(!1),N=o=>{p.get("/v1/role/get_coca",{params:{role_id:o}}).then(e=>{O.value=e.data.options,b.value=e.data.checkeds,I.value=o}),g.value=!0},V=()=>{g.value=!1},$=()=>{p.post("v1/role/change_role",{role_id:I.value,checkeds:b.value}).then(o=>{o.data?d.info().update({title:"\u63D0\u793A!",content:"\u4FEE\u6539\u6210\u529F!",onOk:()=>{_.value=!1,y()}}):d.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!\u8BF7\u68C0\u67E5\u6743\u9650\u53C2\u6570"})}).catch(function(o){d.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"+o.response.data.detail})})},i=C({role_id:0,name:"",role_key:"",description:""}),_=k(!1),B=q(()=>!(i.name&&i.role_key&&i.description)),M=o=>{p.get("/v1/role/get_role_by_id",{params:{role_id:o}}).then(function(e){i.name=e.data.name,i.role_key=e.data.role_key,i.description=e.data.description,i.role_id=o,_.value=!0}).catch(function(e){e&&d.error().update({title:"\u9519\u8BEF!",content:e.response.data.detail,onOk:()=>{c.value=!1}})})},j=()=>{_.value=!1},L=()=>{p.post("/v1/role/update_role",{old_role_id:i.role_id,name:i.name,role_key:i.role_key,description:i.description}).then(function(o){o.data?d.info().update({title:"\u63D0\u793A!",content:"\u4FEE\u6539\u6210\u529F!",onOk:()=>{_.value=!1,y()}}):d.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"})}).catch(function(o){d.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"+o.response.data.detail})})},S=o=>{d.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u5417?",icon:t(te),content:"\u786E\u5B9A\u540E\u4F1A\u5220\u9664\u6B64\u7528\u6237\u7EC4(\u89D2\u8272)",okText:"\u786E\u5B9A",okType:"danger",cancelText:"\u53D6\u6D88",onOk(){p.get("v1/role/delete_role",{params:{role_id:o}}).then(function(e){e.data&&(y(),d.info().update({title:"\u63D0\u793A!",content:"\u5220\u9664\u6210\u529F!"}))}).catch(function(e){d.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"+e.response.data.detail})})},onCancel(){console.log("Cancel")}})},n=C({name:"",role_key:"",description:""}),R={name:[{required:!0,message:"Please enter user name"}],role_key:[{required:!0,message:"Please enter user role_key"}],description:[{required:!0,message:"Please enter role description"}]},c=k(!1),A=()=>{c.value=!0},G=()=>{c.value=!1,n.name="",n.role_key="",n.description=""},U=()=>{p.post("/v1/role/create_role",{name:n.name,role_key:n.role_key,description:n.description,user_id:sessionStorage.getItem("user_id")}).then(function(o){o.data?d.info().update({title:"\u63D0\u793A!",content:"\u521B\u5EFA\u6210\u529F!",onOk:()=>{c.value=!1,y()}}):d.error().update({title:"\u9519\u8BEF!",content:"\u521B\u5EFA\u5931\u8D25!"}),n.name="",n.role_key="",n.description=""}).catch(function(o){o&&d.error().update({title:"\u9519\u8BEF!",content:o.response.data.detail,onOk:()=>{c.value=!1,n.name="",n.role_key="",n.description=""}})})},H=o=>{console.log("Failed:",o)},J=q(()=>!(n.name&&n.role_key&&n.description)),K=k([{title:"Id",dataIndex:"id",key:"id"},{title:"\u540D\u79F0",dataIndex:"name",key:"name"},{title:"\u89D2\u8272key",dataIndex:"role_key",key:"role_key"},{title:"\u7B80\u4ECB",key:"description",dataIndex:"description"},{title:"\u7BA1\u7406",key:"action"}]),E=k([]),y=()=>{p.get("v1/role/get_roles").then(function(o){E.value=o.data}).catch(function(o){console.log(o)})};return y(),(o,e)=>{const r=s("a-button"),Q=s("a-space"),W=s("a-card"),D=s("a-divider"),X=s("a-table"),m=s("a-input"),v=s("a-form-item"),T=s("a-form"),P=s("a-drawer"),Y=s("a-checkbox-group");return x(),w(z,null,[t(W,{style:{"margin-bottom":"10px"}},{default:l(()=>[t(Q,null,{default:l(()=>[t(r,{type:"primary",onClick:A},{default:l(()=>[u("\u521B\u5EFA\u7528\u6237\u7EC4")]),_:1})]),_:1})]),_:1}),t(X,{columns:K.value,"data-source":E.value},{headerCell:l(({columns:a})=>[]),bodyCell:l(({column:a,record:f})=>[a.key==="action"?(x(),w("span",ae,[t(r,{type:"primary",size:"small",onClick:h=>M(f.id)},{icon:l(()=>[t(F(le))]),_:2},1032,["onClick"]),t(D,{type:"vertical"}),t(r,{type:"primary",size:"small",onClick:h=>S(f.id)},{icon:l(()=>[t(F(oe))]),_:2},1032,["onClick"]),t(D,{type:"vertical"}),t(r,{type:"primary",size:"small",onClick:h=>N(f.id)},{default:l(()=>[u(" \u7F16\u8F91\u6743\u9650 ")]),_:2},1032,["onClick"])])):Z("",!0)]),_:1},8,["columns","data-source"]),t(P,{title:"\u521B\u5EFA\u7528\u6237\u7EC4(\u89D2\u8272)",width:"550",visible:c.value,"onUpdate:visible":e[3]||(e[3]=a=>c.value=a)},{extra:l(()=>[t(r,{onClick:G},{default:l(()=>[u("\u53D6\u6D88")]),_:1}),t(r,{disabled:F(J),type:"primary",onClick:U},{default:l(()=>[u("\u63D0\u4EA4")]),_:1},8,["disabled"])]),default:l(()=>[t(T,{model:n,rules:R,layout:"vertical",onFinish:U,onFinishFailed:H},{default:l(()=>[t(v,{label:"\u89D2\u8272\u540D\u79F0",name:"name"},{default:l(()=>[t(m,{value:n.name,"onUpdate:value":e[0]||(e[0]=a=>n.name=a),placeholder:"Please enter name"},null,8,["value"])]),_:1}),t(v,{label:"role_key",name:"role_key"},{default:l(()=>[t(m,{value:n.role_key,"onUpdate:value":e[1]||(e[1]=a=>n.role_key=a),placeholder:"Please enter role_key"},null,8,["value"])]),_:1}),t(v,{label:"\u89D2\u8272\u7B80\u4ECB",name:"description"},{default:l(()=>[t(m,{value:n.description,"onUpdate:value":e[2]||(e[2]=a=>n.description=a),placeholder:"Please enter description"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),t(P,{title:"\u7F16\u8F91\u7528\u6237\u7EC4(\u89D2\u8272)",width:"550",visible:_.value,"onUpdate:visible":e[8]||(e[8]=a=>_.value=a)},{extra:l(()=>[t(r,{onClick:j},{default:l(()=>[u("\u53D6\u6D88")]),_:1}),t(r,{disabled:F(B),type:"primary",onClick:L},{default:l(()=>[u("\u63D0\u4EA4")]),_:1},8,["disabled"])]),default:l(()=>[t(T,{model:i,rules:R,layout:"vertical",onFinish:U},{default:l(()=>[t(m,{value:i.role_id,"onUpdate:value":e[4]||(e[4]=a=>i.role_id=a),type:"hidden"},null,8,["value"]),t(v,{label:"\u89D2\u8272\u540D\u79F0",name:"name"},{default:l(()=>[t(m,{value:i.name,"onUpdate:value":e[5]||(e[5]=a=>i.name=a),placeholder:"Please enter name"},null,8,["value"])]),_:1}),t(v,{label:"role_key",name:"role_key"},{default:l(()=>[t(m,{value:i.role_key,"onUpdate:value":e[6]||(e[6]=a=>i.role_key=a),placeholder:"Please enter role_key"},null,8,["value"])]),_:1}),t(v,{label:"\u89D2\u8272\u7B80\u4ECB",name:"description"},{default:l(()=>[t(m,{value:i.description,"onUpdate:value":e[7]||(e[7]=a=>i.description=a),placeholder:"Please enter description"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),t(P,{title:"\u7F16\u8F91\u6743\u9650",width:"550",visible:g.value,"onUpdate:visible":e[9]||(e[9]=a=>g.value=a)},{extra:l(()=>[t(r,{onClick:V},{default:l(()=>[u("\u53D6\u6D88")]),_:1}),t(r,{type:"primary",onClick:$},{default:l(()=>[u("\u63D0\u4EA4")]),_:1})]),default:l(()=>[(x(!0),w(z,null,ee(O.value,(a,f)=>(x(),w("div",null,[t(Y,{value:b.value[f],"onUpdate:value":h=>b.value[f]=h,options:a},null,8,["value","onUpdate:value","options"])]))),256))]),_:1},8,["visible"])],64)}}};export{de as default};
