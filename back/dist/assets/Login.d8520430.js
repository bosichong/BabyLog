import{u as y,a as b,k as x,b as o,o as S,d as I,c as e,w as t,e as l,f as d,g as p,M as F}from"./index.a51140a0.js";import{U as L,L as U}from"./UserOutlined.4da78fbb.js";const B={class:"minilogin"},O={__name:"Login",setup(A){const c=y(),s=b({username:"",password:"",remember:!0}),_=r=>(sessionStorage.clear(),p.post("v1/token",{username:r.username,password:r.password},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){let i=a.data.access_token;sessionStorage.setItem("token",i),p.defaults.headers={accept:"application / json",Authorization:"Bearer "+sessionStorage.getItem("token")},sessionStorage.getItem("username")===null&&p.get("v1/user/me",{headers:{accept:"application / json",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(function(n){sessionStorage.setItem("user_id",n.data.id),sessionStorage.setItem("username",n.data.username),sessionStorage.setItem("email",n.data.email),sessionStorage.setItem("sex",n.data.sex),c.push("/admin/main")})}).catch(function(a){F.error().update({title:"\u9519\u8BEF!",content:a.response.data.detail})}),!1),f=r=>{console.log("Failed:",r)},g=x(()=>!(s.username&&s.password));return(r,a)=>{const i=o("a-typography-title"),n=o("a-input"),u=o("a-form-item"),w=o("a-input-password"),h=o("a-button"),v=o("router-link"),k=o("a-form");return S(),I("div",B,[e(i,{level:3},{default:t(()=>[l("Mini Admin")]),_:1}),e(k,{model:s,name:"normal_login",class:"login-form",onFinish:_,onFinishFailed:f},{default:t(()=>[e(u,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:t(()=>[e(n,{value:s.username,"onUpdate:value":a[0]||(a[0]=m=>s.username=m)},{prefix:t(()=>[e(d(L),{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),e(u,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:t(()=>[e(w,{value:s.password,"onUpdate:value":a[1]||(a[1]=m=>s.password=m)},{prefix:t(()=>[e(d(U),{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),e(u,null,{default:t(()=>[e(h,{disabled:d(g),type:"primary","html-type":"submit",class:"login-form-button"},{default:t(()=>[l(" Log in ")]),_:1},8,["disabled"]),l(" Or "),e(v,{to:"/register"},{default:t(()=>[l("register now!")]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{O as default};
